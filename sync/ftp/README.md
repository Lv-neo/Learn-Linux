# 文件传输协议
FTP 是File Transfer Protocol（文件传输协议）的英文简称，而中文简称为“文传协议”。用于Internet上的控制文件的双向传输。同时，它也是一个应用程序（Application）。基于不同的操作系统有不同的FTP应用程序，而所有这些应用程序都遵守同一种协议以传输文件。在FTP的使用当中，用户经常遇到两个概念："下载"（Download）和"上传"（Upload）。"下载"文件就是从远程主机拷贝文件至自己的计算机上；"上传"文件就是将文件从自己的计算机中拷贝至远程主机上。用Internet语言来说，用户可通过客户机程序向（从）远程主机上传（下载）文件。

##运行机制

###FTP服务器
简单地说，支持FTP协议的服务器就是FTP服务器。

与大多数Internet服务一样，FTP也是一个客户机/服务器系统。用户通过一个支持FTP协议的客户机程序，连接到在远程主机上的FTP服务器程序。用户通过客户机程序向服务器程序发出命令，服务器程序执行用户所发出的命令，并将执行的结果返回到客户机。比如说，用户发出一条命令，要求服务器向用户传送某一个文件的一份拷贝，服务器会响应这条命令，将指定文件送至用户的机器上。客户机程序代表用户接收到这个文件，将其存放在用户目录中。

###匿名FTP
使用FTP时必须首先登录，在远程主机上获得相应的权限以后，方可下载或上传文件。也就是说，要想同哪一台计算机传送文件，就必须具有哪一台计算机的适当授权。换言之，除非有用户ID和口令，否则便无法传送文件。这种情况违背了Internet的开放性，Internet上的FTP主机何止千万，不可能要求每个用户在每一台主机上都拥有帐号。匿名FTP就是为解决这个问题而产生的。

匿名FTP是这样一种机制，用户可通过它连接到远程主机上，并从其下载文件，而无需成为其注册用户。系统管理员建立了一个特殊的用户ID，名为anonymous, Internet上的任何人在任何地方都可使用该用户ID。

通过FTP程序连接匿名FTP主机的方式同连接普通FTP主机的方式差不多，只是在要求提供用户标识ID时必须输入anonymous，该用户ID的口令可以是任意的字符串。习惯上，用自己的E-mail地址作为口令，使系统维护程序能够记录下来谁在存取这些文件。

值得注意的是，匿名FTP不适用于所有Internet主机，它只适用于那些提供了这项服务的主机。

当远程主机提供匿名FTP服务时，会指定某些目录向公众开放，允许匿名存取。系统中的其余目录则处于隐匿状态。作为一种安全措施，大多数匿名FTP主机都允许用户从其下载文件，而不允许用户向其上传文件，也就是说，用户可将匿名FTP主机上的所有文件全部拷贝到自己的机器上，但不能将自己机器上的任何一个文件拷贝至匿名FTP主机上。即使有些匿名FTP主机确实允许用户上传文件，用户也只能将文件上传至某一指定上传目录中。随后，系统管理员会去检查这些文件，他会将这些文件移至另一个公共下载目录中，供其他用户下载，利用这种方式，远程主机的用户得到了保护，避免了有人上传有问题的文件，如带病毒的文件。

##用户分类

###Real帐户
这类用户是指在FTP服务上拥有帐号。当这类用户登录FTP服务器的时候，其默认的主目录就是其帐号命名的目录。但是，其还可以变更到其他目录中去。如系统的主目录等等。

###Guest用户
在FTP服务器中，我们往往会给不同的部门或者某个特定的用户设置一个帐户。但是，这个账户有个特点，就是其只能够访问自己的主目录。服务器通过这种方式来保障FTP服务上其他文件的安全性。这类帐户，在Vsftpd软件中就叫做Guest用户。拥有这类用户的帐户，只能够访问其主目录下的目录，而不得访问主目录以外的文件。

###Anonymous（匿名）用户
这也是我们通常所说的匿名访问。这类用户是指在FTP服务器中没有指定帐户，但是其仍然可以进行匿名访问某些公开的资源。
在组建FTP服务器的时候，我们就需要根据用户的类型，对用户进行归类。默认情况下，Vsftpd服务器会把建立的所有帐户都归属为Real用户。但是，这往往不符合企业安全的需要。因为这类用户不仅可以访问自己的主目录，而且，还可以访问其他用户的目录。这就给其他用户所在的空间带来一定的安全隐患。所以，企业要根据实际情况，修改用户所在的类别。

##使用方式
TCP/IP协议中，FTP标准命令TCP端口号为21，Port方式数据端口为20。FTP的任务是从一台计算机将文件传送到另一台计算机，不受操作系统的限制。

需要进行远程文件传输的计算机必须安装和运行ftp客户程序。在windows操作系统的安装过程中，通常都安装了tcp/ip协议软件，其中就包含了ftp客户程序。但是该程序是字符界面而不是图形界面，这就必须以命令提示符的方式进行操作，很不方便。

启动ftp客户程序工作的另一途径是使用ie浏览器，用户只需要在ie地址栏中输入如下格式的url地址：
```
ftp：//[用户名：口令@]ftp服务器域名：[端口号]
```
(在CMD命令行下也可以用上述方法连接，通过put命令和get命令达到上传和下载的目的，通过ls命令列出目录，除了上述方法外还可以在cmd下输入ftp回车，然后输入open IP来建立一个连接，此方法还适用于linux下连接ftp服务器)

通过ie浏览器启动ftp的方法尽管可以使用，但是速度较慢，还会将密码暴露在ie浏览器中而不安全。因此一般都安装并运行专门的ftp客户程序。

1. 在本地电脑上登陆到国际互联网。
2. 搜索有文件共享主机或者个人电脑(一般有专门的FTP服务器网站上公布的,上面有进入该主机或个人电脑的名称，口令和路径).
3. 当与远程主机或者对方的个人电脑建立连接后,用对方提供的用户名和口令登陆到该主机或对方的个人电脑。
5. 在远程主机或对方的个人电脑登陆成功后，就可以上传你想跟别人分享的东西或者下载别人授权共享的东西(这里的东西是指能放到电脑里去又能在显示屏上看到的东西).
6. 完成工作后关闭FTP下载软件,切断连接。

##传输方式
FTP的传输有两种方式：ASCII、二进制。

###ASCII传输方式
假定用户正在拷贝的文件包含的简单ASCII码文本，如果在远程机器上运行的不是UNIX，当文件传输时ftp通常会自动地调整文件的内容以便于把文件解释成另外那台计算机存储文本文件的格式。

但是常常有这样的情况，用户正在传输的文件包含的不是文本文件，它们可能是程序，数据库，字处理文件或者压缩文件。在拷贝任何非文本文件之前，用binary 命令告诉ftp逐字拷贝。

###二进制传输模式
在二进制传输中，保存文件的位序，以便原始和拷贝的是逐位一一对应的。即使目的地机器上包含位序列的文件是没意义的。例如，macintosh以二进制方式传送可执行文件到Windows系统，在对方系统上，此文件不能执行。

如在ASCII方式下传输二进制文件，即使不需要也仍会转译。这会损坏数据。（ASCII方式一般假设每一字符的第一有效位无意义，因为ASCII字符组合不使用它。如果传输二进制文件，所有的位都是重要的。）

##支持模式
FTP支持两种模式：Standard (PORT方式，主动方式)，Passive (PASV，被动方式)。

###Port模式
FTP 客户端首先和服务器的TCP 21端口建立连接，用来发送命令，客户端需要接收数据的时候在这个通道上发送PORT命令。PORT命令包含了客户端用什么端口接收数据。在传送数据的时候，服务器端通过自己的TCP 20端口连接至客户端的指定端口发送数据。FTP server必须和客户端建立一个新的连接用来传送数据。

###Passive模式
建立控制通道和Standard模式类似，但建立连接后发送Pasv命令。服务器收到Pasv命令后，打开一个临时端口（端口号大于1023小于65535）并且通知客户端在这个端口上传送数据的请求，客户端连接FTP服务器此端口，然后FTP服务器将通过这个端口传送数据。

很多防火墙在设置的时候都是不允许接受外部发起的连接的，所以许多位于防火墙后或内网的FTP服务器不支持PASV模式，因为客户端无法穿过防火墙打开FTP服务器的高端端口；而许多内网的客户端不能用PORT模式登陆FTP服务器，因为从服务器的TCP 20无法和内部网络的客户端建立一个新的连接，造成无法工作。

##命令参数
###简介
1. FTP服务器的登陆
匿名用户：FTP 口令：FTP
用户：ANONYMOUS 口令：任何电子邮件
2. 显示文件信息：DIR/LS
3. 下载文件：GET 文件名（下载到当前目录）
4. 上传文件：PUT 文件名
5. 多文件下载：MGET
6. 多文件上传：MPUT
7. 退出：BYE
8. 帮助：HELP

###语法
ftp [ -d] [ -g ] [ -i ] [ -n ] [ -v] [ -f ] [ -k realm] [-q[-C]][ HostName [ Port ] ]

###描述
```
-C 允许用户指定：通过 send_file 命令发出的文件必须在网络高速缓冲区（NBC）中经过缓存处理。此标志必须在指定了

-q 标志的情况下使用。只有当文件在无保护的情况下以二进制方式发送时此标志才适用。

-d 将有关 ftp 命令操作的调试信息发送给 syslogd 守护进程。如果您指定-d 标志，您必须编辑/etc/syslog.conf 文件并添加下列中的一项：OR user.debug FileName
请注意： syslogd 守护进程调试级别包含信息级别消息。
如果不编辑/etc/syslog.conf 文件，则不会产生消息。变更了/etc/syslog.conf 文件之后，请运行 refresh -s syslogd 或 kill -1 SyslogdPID 命令，以通知 syslogd 守护进程其配置文件的变更。关于调试级别的更多信息，请参考/etc/syslog.conf 文件。也请参考 debug 子命令。

-g 禁用文件名中的元字符拓展。解释元字符可参考为扩展（有时叫做文件名匹配替换）文件名。请参考 glob 子命令。

-i 关闭多文件传送中的交互式提示。请参考 prompt、mget、mput 和 mdelete 子命令，以取得多文件传送中的提示的描述。

-n 防止在起始连接中的自动登录。否则， ftp 命令会搜索$HOME/.netrc 登录项，该登录项描述了远程主机的登录和初始化过程。请参考 user 子命令。

-q 允许用户指定： send_file 子例程必须用于在网络上发送文件。只有当文件在无保护的情况下以二进制方式发送时此标志才适用。

-v 显示远程服务器的全部响应，并提供数据传输的统计信息。当 ftp 命令的输出是到终端（如控制台或显示）时，此显示方式是缺省方式。
如果 stdin 不是终端，除非用户调用带有-v 标志的 ftp 命令，或发送 verbose 子命令，否则 ftp 详细方式将禁用。

-f 导致转发凭证。如果Kerberos 5 不是当前认证方法，则此标志将被忽略。

-k realm 如果远程站的域不同于本地系统的域，系统将允许用户指定远程站的域。因此，域和DCE 单元是同义的。如果Kerberos 5 不是当前认证方法，则此标志将被忽略。
```



